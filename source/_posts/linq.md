---
title: 使用LINQ操作SQLServer中的数据
date: 2018-06-07 19:23:25
tags:
---

标签（空格分隔）： C#

---

## 什么是LINQ？
* Linq (Language Integrated Query,语言集成查询),是微软公司提供的一项新技术，它能够将查询功能引入到.NET 3.5 所支持的编程语言中，例如C#，Visual Basic.NET。 
* 查询操作通过编程语言来表达，而不再是以字符串的形式嵌入到应用程序中。

## 实例演示

### 创建项目

* 创建控制台项目

![Aaron Swartz](https://raw.githubusercontent.com/Lynn1984/Lynn1984.github.io/master/image/linq/1.png)

* 添加Linq TO SQL 新建项

![Aaron Swartz](https://raw.githubusercontent.com/Lynn1984/Lynn1984.github.io/master/image/linq/3.png)

### 视图-》服务器资源管理器

![Aaron Swartz](https://raw.githubusercontent.com/Lynn1984/Lynn1984.github.io/master/image/linq/2.png)

* 添加连接，连接SQLServer中的数据库

![Aaron Swartz](https://raw.githubusercontent.com/Lynn1984/Lynn1984.github.io/master/image/linq/4.png)

* 在数据库中添加Employee表

![Aaron Swartz](https://raw.githubusercontent.com/Lynn1984/Lynn1984.github.io/master/image/linq/5.png)

* 把表Employee拖到dbml文件中

![Aaron Swartz](https://raw.githubusercontent.com/Lynn1984/Lynn1984.github.io/master/image/linq/6.png)

* 自动生成DataContext和Employee类

![Aaron Swartz](https://raw.githubusercontent.com/Lynn1984/Lynn1984.github.io/master/image/linq/7.png)

```
#pragma warning disable 1591
//------------------------------------------------------------------------------
// <auto-generated>
//     此代码由工具生成。
//     运行时版本:4.0.30319.42000
//
//     对此文件的更改可能会导致不正确的行为，并且如果
//     重新生成代码，这些更改将会丢失。
// </auto-generated>
//------------------------------------------------------------------------------

namespace LinaDemo
{
	using System.Data.Linq;
	using System.Data.Linq.Mapping;
	using System.Data;
	using System.Collections.Generic;
	using System.Reflection;
	using System.Linq;
	using System.Linq.Expressions;
	using System.ComponentModel;
	using System;
	
	
	[global::System.Data.Linq.Mapping.DatabaseAttribute(Name="MVCDemoDB")]
	public partial class LinqToSqlDataContext : System.Data.Linq.DataContext
	{
		
		private static System.Data.Linq.Mapping.MappingSource mappingSource = new AttributeMappingSource();
		
    #region 可扩展性方法定义
    partial void OnCreated();
    partial void InsertEmployee(Employee instance);
    partial void UpdateEmployee(Employee instance);
    partial void DeleteEmployee(Employee instance);
    #endregion
		
		public LinqToSqlDataContext() : 
				base(global::LinaDemo.Properties.Settings.Default.MVCDemoDBConnectionString, mappingSource)
		{
			OnCreated();
		}
		
		public LinqToSqlDataContext(string connection) : 
				base(connection, mappingSource)
		{
			OnCreated();
		}
		
		public LinqToSqlDataContext(System.Data.IDbConnection connection) : 
				base(connection, mappingSource)
		{
			OnCreated();
		}
		
		public LinqToSqlDataContext(string connection, System.Data.Linq.Mapping.MappingSource mappingSource) : 
				base(connection, mappingSource)
		{
			OnCreated();
		}
		
		public LinqToSqlDataContext(System.Data.IDbConnection connection, System.Data.Linq.Mapping.MappingSource mappingSource) : 
				base(connection, mappingSource)
		{
			OnCreated();
		}
		
		public System.Data.Linq.Table<Employee> Employee
		{
			get
			{
				return this.GetTable<Employee>();
			}
		}
	}
	
	[global::System.Data.Linq.Mapping.TableAttribute(Name="dbo.Employee")]
	public partial class Employee : INotifyPropertyChanging, INotifyPropertyChanged
	{
		
		private static PropertyChangingEventArgs emptyChangingEventArgs = new PropertyChangingEventArgs(String.Empty);
		
		private int _Id;
		
		private string _name;
		
		private string _fname;
		
		private System.Nullable<int> _age;
		
		private string _sem;
		
    #region 可扩展性方法定义
    partial void OnLoaded();
    partial void OnValidate(System.Data.Linq.ChangeAction action);
    partial void OnCreated();
    partial void OnIdChanging(int value);
    partial void OnIdChanged();
    partial void OnnameChanging(string value);
    partial void OnnameChanged();
    partial void OnfnameChanging(string value);
    partial void OnfnameChanged();
    partial void OnageChanging(System.Nullable<int> value);
    partial void OnageChanged();
    partial void OnsemChanging(string value);
    partial void OnsemChanged();
    #endregion
		
		public Employee()
		{
			OnCreated();
		}
		
		[global::System.Data.Linq.Mapping.ColumnAttribute(Storage="_Id", AutoSync=AutoSync.OnInsert, DbType="Int NOT NULL IDENTITY", IsPrimaryKey=true, IsDbGenerated=true)]
		public int Id
		{
			get
			{
				return this._Id;
			}
			set
			{
				if ((this._Id != value))
				{
					this.OnIdChanging(value);
					this.SendPropertyChanging();
					this._Id = value;
					this.SendPropertyChanged("Id");
					this.OnIdChanged();
				}
			}
		}
		
		[global::System.Data.Linq.Mapping.ColumnAttribute(Storage="_name", DbType="NChar(20)")]
		public string name
		{
			get
			{
				return this._name;
			}
			set
			{
				if ((this._name != value))
				{
					this.OnnameChanging(value);
					this.SendPropertyChanging();
					this._name = value;
					this.SendPropertyChanged("name");
					this.OnnameChanged();
				}
			}
		}
		
		[global::System.Data.Linq.Mapping.ColumnAttribute(Storage="_fname", DbType="NChar(20)")]
		public string fname
		{
			get
			{
				return this._fname;
			}
			set
			{
				if ((this._fname != value))
				{
					this.OnfnameChanging(value);
					this.SendPropertyChanging();
					this._fname = value;
					this.SendPropertyChanged("fname");
					this.OnfnameChanged();
				}
			}
		}
		
		[global::System.Data.Linq.Mapping.ColumnAttribute(Storage="_age", DbType="Int")]
		public System.Nullable<int> age
		{
			get
			{
				return this._age;
			}
			set
			{
				if ((this._age != value))
				{
					this.OnageChanging(value);
					this.SendPropertyChanging();
					this._age = value;
					this.SendPropertyChanged("age");
					this.OnageChanged();
				}
			}
		}
		
		[global::System.Data.Linq.Mapping.ColumnAttribute(Storage="_sem", DbType="VarChar(50)")]
		public string sem
		{
			get
			{
				return this._sem;
			}
			set
			{
				if ((this._sem != value))
				{
					this.OnsemChanging(value);
					this.SendPropertyChanging();
					this._sem = value;
					this.SendPropertyChanged("sem");
					this.OnsemChanged();
				}
			}
		}
		
		public event PropertyChangingEventHandler PropertyChanging;
		
		public event PropertyChangedEventHandler PropertyChanged;
		
		protected virtual void SendPropertyChanging()
		{
			if ((this.PropertyChanging != null))
			{
				this.PropertyChanging(this, emptyChangingEventArgs);
			}
		}
		
		protected virtual void SendPropertyChanged(String propertyName)
		{
			if ((this.PropertyChanged != null))
			{
				this.PropertyChanged(this, new PropertyChangedEventArgs(propertyName));
			}
		}
	}
}
#pragma warning restore 1591

```

## 插入新数据

```
namespace LinaDemo
{
    class Program
    {
        static void Main(string[] args)
        {
            string strCon = "Data Source=127.0.0.1;Initial Catalog=MVCDemoDB;Persist Security Info=True;User ID=sa;Password=123456";//Sql Server连接字串

            LinqToSqlDataContext dc = new LinqToSqlDataContext(strCon);
            Employee employee = new Employee();
            employee.name = "Lynn";
            employee.fname = "Liu";
            employee.age = 34;
            employee.sem = "female";

            dc.Employee.InsertOnSubmit(employee);
            dc.SubmitChanges();   //更新数据库（插入一条记录）
        }
    }
}
```

运行效果：

![Aaron Swartz](https://raw.githubusercontent.com/Lynn1984/Lynn1984.github.io/master/image/linq/8.png)

## 查询数据

```
    class Program
    {
        static void Main(string[] args)
        {
            string strCon = "Data Source=127.0.0.1;Initial Catalog=MVCDemoDB;Persist Security Info=True;User ID=sa;Password=123456";//Sql Server连接字串

            LinqToSqlDataContext dc = new LinqToSqlDataContext(strCon);

            Employee employee = new Employee();
            employee.name = "Lynn";
            employee.fname = "Liu";
            employee.age = 34;
            employee.sem = "female";

            dc.Employee.InsertOnSubmit(employee);
            dc.SubmitChanges();   //更新数据库（插入一条记录）

            employee = new Employee();
            employee.name = "Barry";
            employee.fname = "Li";
            employee.age = 34;
            employee.sem = "male";

            dc.Employee.InsertOnSubmit(employee);
            dc.SubmitChanges();   //更新数据库（插入一条记录）

            select(dc);
        }

        static void select(LinqToSqlDataContext db)
        {
            // Get a typed table to run queries.
            Table<Employee> Employees = db.GetTable<Employee>();

            // Query for customers from London.
            var query = from cust in Employees select cust;

            foreach (var cust in query)
                Console.WriteLine("id = {0}, City = {1}", cust.name, cust.fname);
            Console.ReadLine();
        }
    }
```

运行效果：

![Aaron Swartz](https://raw.githubusercontent.com/Lynn1984/Lynn1984.github.io/master/image/linq/9.png)